#! /bin/bash

# If the SSL certificates have been generated start squid otherwise just run cat
if [ -e /etc/ssl/taisun.crt ] && [ -e /etc/ssl/taisun.key ] && [ -n "${SQUIDPASS+set}" ] && [ -n "${SQUIDUSER+set}" ]; then
  # Generate basic auth file from env variables
  /usr/bin/htpasswd -b -c /etc/squid3/passwords "$SQUIDUSER" "$SQUIDPASS"
  # Generate cache if needed
  /usr/sbin/squid3 -z 
  wait
  # Start squid
  /usr/sbin/squid3 -NYCd 1
else
  echo "Missing Env Variables for user or ssl certificates to run squid"
  cat
fi
